<!DOCTYPE html>
<html>
<head>
    <title>Frontend Data Test</title>
</head>
<body>
    <h1>Testing What Frontend Is Actually Loading</h1>
    <div id="results"></div>

    <script>
        async function testAllDataSources() {
            const results = document.getElementById('results');
            let html = '<h2>Data Source Test Results:</h2><ul>';

            // Test 1: Graph API nodes endpoint
            try {
                const nodesResp = await fetch('http://localhost:8084/api/graph/nodes?limit=500');
                const nodesData = await nodesResp.json();
                html += `<li>✅ API /nodes endpoint: <strong>${nodesData.nodes?.length || 0} nodes</strong></li>`;
            } catch (e) {
                html += `<li>❌ API /nodes endpoint: ${e.message}</li>`;
            }

            // Test 2: Graph API edges endpoint
            try {
                const edgesResp = await fetch('http://localhost:8084/api/graph/edges?limit=5000');
                const edgesData = await edgesResp.json();
                html += `<li>✅ API /edges endpoint: <strong>${edgesData.edges?.length || 0} edges</strong></li>`;
            } catch (e) {
                html += `<li>❌ API /edges endpoint: ${e.message}</li>`;
            }

            // Test 3: Static JSON file
            try {
                const staticResp = await fetch('/live-performance-data.json');
                const staticData = await staticResp.json();
                html += `<li>✅ Static JSON file: <strong>${staticData.nodes?.length || 0} nodes</strong></li>`;
            } catch (e) {
                html += `<li>❌ Static JSON file: ${e.message}</li>`;
            }

            // Test 4: Check localStorage
            const localStorageKeys = Object.keys(localStorage);
            html += `<li>localStorage keys: ${localStorageKeys.length > 0 ? localStorageKeys.join(', ') : 'empty'}</li>`;

            // Test 5: Check sessionStorage
            const sessionStorageKeys = Object.keys(sessionStorage);
            html += `<li>sessionStorage keys: ${sessionStorageKeys.length > 0 ? sessionStorageKeys.join(', ') : 'empty'}</li>`;

            html += '</ul>';

            // Now test what the actual dataLoader function would do
            html += '<h2>Simulating dataLoader.ts logic:</h2><ul>';

            try {
                const baseUrl = 'http://localhost:8084';
                const [nodesResponse, edgesResponse] = await Promise.all([
                    fetch(`${baseUrl}/api/graph/nodes?limit=500`),
                    fetch(`${baseUrl}/api/graph/edges?limit=5000`)
                ]);

                const nodesData = await nodesResponse.json();
                const edgesData = await edgesResponse.json();

                html += `<li>dataLoader would get: <strong>${nodesData.nodes?.length || 0} nodes</strong> and <strong>${edgesData.edges?.length || 0} edges</strong></li>`;

                if (!nodesData.nodes || nodesData.nodes.length === 0) {
                    html += `<li>⚠️ API returned empty, dataLoader would fall back to static JSON</li>`;

                    // Check static fallback
                    const fallbackResp = await fetch('/live-performance-data.json');
                    if (fallbackResp.ok) {
                        const fallbackData = await fallbackResp.json();
                        html += `<li>Static fallback has: <strong>${fallbackData.nodes?.length || 0} nodes</strong></li>`;
                    }
                }
            } catch (e) {
                html += `<li>❌ Error in dataLoader simulation: ${e.message}</li>`;
            }

            html += '</ul>';
            results.innerHTML = html;

            // Also log to console
            console.log('Test complete - check the page for results');
        }

        testAllDataSources();
    </script>
</body>
</html>