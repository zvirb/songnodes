---
config:
  layout: elk
---
flowchart TB
 subgraph subGraph0["Frontend Application (React + Zustand)"]
        FE_Main["Frontend App<br>Port: 3006<br>React + TypeScript"]
        FE_Target["Target Tracks Manager<br>🎯 CRUD Operations<br>Add/Edit/Delete tracks"]
        FE_Graph["Graph Visualization<br>D3.js Force Layout<br>WebGL Acceleration"]
        FE_DJ["DJ Interface<br>Virtual Mixing<br>Path Builder"]
        FE_Stats["Statistics Panel<br>Performance Metrics<br>Real-time Data"]
  end
 subgraph subGraph1["API Gateway & Services"]
        API_GW["API Gateway<br>Port: 8080<br>Request Router"]
        REST_API["REST API Enhanced<br>Port: 8082<br>Target Track Endpoints<br>CRUD Operations"]
        GRAPH_API["Graph API<br>Port: 8084<br>Adjacency Data"]
        WS_API["WebSocket API<br>Port: 8083<br>Real-time Updates"]
  end
 subgraph subGraph2["Orchestration & Discovery"]
        ORCH["Scraper Orchestrator<br>Port: 8001<br>📅 Daily Schedule 1:30 AM<br>Database-driven"]
        SEARCHER["Target Track Searcher<br>🔍 Missing Link Component<br>Playlist Discovery Engine"]
  end
 subgraph subGraph3["Message Queue & Cache"]
        RABBIT["RabbitMQ<br>Port: 5673<br>Task Queue"]
        REDIS["Redis Cache<br>Port: 6380<br>Session Storage"]
  end
 subgraph subGraph4["Scraper Fleet"]
        SCRAPER_1001["1001tracklists Scraper<br>Port: 8011<br>✅ Playlist Items<br>✅ Track Adjacencies"]
        SCRAPER_MIX["MixesDB Scraper<br>Port: 8012<br>✅ Playlist Items<br>✅ Track Adjacencies"]
        SCRAPER_SET["Setlist.fm Scraper<br>Port: 8013<br>✅ Playlist Items<br>✅ Track Adjacencies"]
        OLLAMA["Ollama LLM<br>Port: 11434<br>HTML Adaptation<br>GPU Accelerated"]
  end
 subgraph subGraph5["Target Discovery System"]
        TARGET_TRACKS@{ label: "target_tracks<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>\n                track_id: UUID PRIMARY KEY<br>\n                title: VARCHAR(500) NOT NULL<br>\n                artist: VARCHAR(255) NOT NULL<br>\n                priority: VARCHAR(20) DEFAULT 'medium'<br>\n                search_terms: TEXT[]<br>\n                genres: TEXT[]<br>\n                last_searched: TIMESTAMP<br>\n                times_searched: INTEGER<br>\n                playlists_found: INTEGER DEFAULT 0<br>\n                adjacencies_found: INTEGER DEFAULT 0<br>\n                is_active: BOOLEAN DEFAULT TRUE<br>\n                added_at: TIMESTAMP DEFAULT NOW()<br>\n                updated_at: TIMESTAMP DEFAULT NOW()<br>\n                UNIQUE(title, artist)<br>\n                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>\n                📊 145 records (ACTIVE)" }
        TARGET_SEARCHES["target_track_searches<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                search_id: UUID PRIMARY KEY<br>
                target_title: VARCHAR(500)<br>
                target_artist: VARCHAR(255)<br>
                search_query: TEXT<br>
                scraper_name: VARCHAR(50)<br>
                results_found: INTEGER<br>
                playlists_containing: INTEGER<br>
                search_timestamp: TIMESTAMP<br>
                run_id: UUID FK → scraping_runs<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 0 records (WILL POPULATE)"]
        PLAYLIST_DISC["playlist_discovery<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                playlist_id: UUID FK → playlists<br>
                discovered_via_track: UUID FK → target_tracks<br>
                discovery_timestamp: TIMESTAMP<br>
                search_platform: VARCHAR(50)<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 0 records (READY FOR USE)"]
  end
 subgraph subGraph6["Core Music Data"]
        SONGS["songs<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                song_id: UUID PRIMARY KEY<br>
                title: VARCHAR(500) NOT NULL<br>
                primary_artist_id: UUID FK → artists<br>
                release_year: INTEGER<br>
                genre: VARCHAR(100)<br>
                bpm: INTEGER<br>
                key: VARCHAR(10)<br>
                duration_seconds: INTEGER<br>
                spotify_id: VARCHAR(100)<br>
                musicbrainz_id: VARCHAR(100)<br>
                isrc: VARCHAR(20)<br>
                label: VARCHAR(255)<br>
                remix_of: UUID FK → songs<br>
                created_at: TIMESTAMP DEFAULT NOW()<br>
                updated_at: TIMESTAMP DEFAULT NOW()<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 22 records (ACTIVE)<br>
                ⚡ Source for Graph Nodes"]
        ARTISTS["artists<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                artist_id: UUID PRIMARY KEY<br>
                name: VARCHAR(255) NOT NULL<br>
                spotify_id: VARCHAR(100)<br>
                musicbrainz_id: VARCHAR(100)<br>
                genres: TEXT[]<br>
                country: VARCHAR(100)<br>
                aliases: TEXT[]<br>
                created_at: TIMESTAMP DEFAULT NOW()<br>
                updated_at: TIMESTAMP DEFAULT NOW()<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 18 records (ACTIVE)"]
        SONG_ADJACENCY["song_adjacency<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                song_id_1: UUID FK → songs NOT NULL<br>
                song_id_2: UUID FK → songs NOT NULL<br>
                occurrence_count: INTEGER DEFAULT 1<br>
                avg_distance: NUMERIC(3,2)<br>
                PRIMARY KEY(song_id_1, song_id_2)<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 110 records (ACTIVE)<br>
                ⚡ Powers Graph Edges &amp; Visualization"]
  end
 subgraph subGraph7["Playlist Management"]
        PLAYLISTS["playlists<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                playlist_id: UUID PRIMARY KEY<br>
                name: VARCHAR(500) NOT NULL<br>
                source: VARCHAR(100) NOT NULL<br>
                source_url: TEXT UNIQUE<br>
                playlist_type: VARCHAR(50)<br>
                dj_artist_id: UUID FK → artists<br>
                event_name: VARCHAR(500)<br>
                venue_id: UUID FK → venues<br>
                event_date: DATE<br>
                duration_minutes: INTEGER<br>
                tracklist_count: INTEGER<br>
                play_count: INTEGER<br>
                like_count: INTEGER<br>
                created_at: TIMESTAMP DEFAULT NOW()<br>
                updated_at: TIMESTAMP DEFAULT NOW()<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 10 records (ACTIVE)<br>
                ✅ NOW POPULATING CORRECTLY"]
        PLAYLIST_SONGS["playlist_songs<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                playlist_id: UUID FK → playlists NOT NULL<br>
                song_id: UUID FK → songs<br>
                position: INTEGER NOT NULL<br>
                transition_rating: INTEGER<br>
                energy_level: INTEGER<br>
                crowd_reaction: VARCHAR(50)<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 0 records (NEEDS IMPLEMENTATION)"]
        VENUES["venues<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                venue_id: UUID PRIMARY KEY<br>
                name: VARCHAR(255) NOT NULL<br>
                city: VARCHAR(100)<br>
                country: VARCHAR(100)<br>
                capacity: INTEGER<br>
                venue_type: VARCHAR(50)<br>
                latitude: NUMERIC<br>
                longitude: NUMERIC<br>
                created_at: TIMESTAMP DEFAULT NOW()<br>
                updated_at: TIMESTAMP DEFAULT NOW()<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 0 records (READY FOR USE)"]
  end
 subgraph subGraph8["Relationship Tables"]
        SONG_ARTISTS["song_artists<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                song_id: UUID FK → songs NOT NULL<br>
                artist_id: UUID FK → artists NOT NULL<br>
                role: VARCHAR(50) NOT NULL<br>
                PRIMARY KEY(song_id, artist_id, role)<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 0 records (NEEDS IMPLEMENTATION)"]
        ARTIST_COLLAB["artist_collaborations<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                artist_id_1: UUID FK → artists NOT NULL<br>
                artist_id_2: UUID FK → artists NOT NULL<br>
                collaboration_count: INTEGER DEFAULT 1<br>
                collaboration_type: VARCHAR(50)<br>
                PRIMARY KEY(artist_id_1, artist_id_2)<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 0 records (READY FOR USE)"]
  end
 subgraph subGraph9["Operations & Monitoring"]
        SCRAPING_RUNS["scraping_runs<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                run_id: UUID PRIMARY KEY<br>
                scraper_name: VARCHAR(50) NOT NULL<br>
                start_time: TIMESTAMP<br>
                end_time: TIMESTAMP<br>
                status: VARCHAR(20)<br>
                tracks_searched: INTEGER<br>
                playlists_found: INTEGER<br>
                songs_added: INTEGER<br>
                artists_added: INTEGER<br>
                errors_count: INTEGER<br>
                error_details: JSONB<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 1 records (MONITORING)"]
        NORM_TRACKS["normalized_tracks<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                id: VARCHAR(255) PRIMARY KEY<br>
                source: VARCHAR(50) NOT NULL<br>
                source_id: VARCHAR(255) NOT NULL<br>
                title: TEXT NOT NULL<br>
                artist: TEXT NOT NULL<br>
                album: TEXT<br>
                genre: VARCHAR(100)<br>
                label: VARCHAR(255)<br>
                release_date: TIMESTAMP<br>
                duration_seconds: INTEGER<br>
                bpm: INTEGER<br>
                key: VARCHAR(10)<br>
                url: TEXT<br>
                fingerprint: VARCHAR(32) NOT NULL<br>
                confidence_score: DOUBLE PRECISION NOT NULL<br>
                metadata: JSONB<br>
                normalized_at: TIMESTAMP NOT NULL<br>
                created_at: TIMESTAMP<br>
                ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>
                📊 1 records (DATA PROCESSING)"]
  end
 subgraph subGraph10["PostgreSQL Database (Port: 5432)"]
        subGraph5
        subGraph6
        subGraph7
        subGraph8
        subGraph9
  end
 subgraph subGraph11["System Status & Legend"]
        L1["✅ = Working & Populated"]
        L2["❌ = Needs Implementation"]
        L3["🆕 = Future Enhancement"]
        L4["📊 = Record Count"]
        L5["⚡ = Powers Graph Visualization"]
        L6["🔄 = User Feedback Loop"]
        L7["Solid Arrow = Active Data Flow"]
        L8["Dashed Arrow = Missing/Future"]
  end
 subgraph subGraph12["Current System Health"]
        STATUS["🎯 TARGET TRACKS: 145 Active<br>
               🎵 PLAYLISTS: 10 Stored ✅<br>
               🎶 SONGS: 22 Active ✅<br>
               🔗 ADJACENCIES: 110 Active ✅<br>
               👨‍🎤 ARTISTS: 18 Active ✅<br>
               🔍 SEARCHER: Wired &amp; Ready ✅<br>
               🗂️ ORCHESTRATOR: Database-driven ✅<br>
               📈 FRONTEND: Target Manager ✅"]
  end
    FE_Main --> FE_Target & FE_Graph & FE_DJ & FE_Stats
    API_GW --> REST_API & GRAPH_API & WS_API
    ORCH --> SEARCHER
    SCRAPER_1001 --> OLLAMA
    SCRAPER_MIX --> OLLAMA & SONGS & ARTISTS
    SCRAPER_SET --> OLLAMA & SONGS & ARTISTS
    FE_Target -. "1. User adds/edits<br>target track" .-> REST_API
    REST_API -. "2. CRUD operations<br>INSERT/UPDATE/DELETE" .-> TARGET_TRACKS
    FE_Target -. 🔄 User management<br>loop completes .-> TARGET_TRACKS
    ORCH -- "3. Daily 1:30 AM<br>Load active targets<br>SELECT * FROM target_tracks<br>WHERE is_active = TRUE" --> TARGET_TRACKS
    ORCH -- "4. Initialize<br>TargetTrackSearcher" --> SEARCHER
    SEARCHER -- "5. Discover playlists<br>containing target tracks" --> RABBIT
    SEARCHER -. "6. Record search results<br>UPDATE target_tracks<br>INSERT target_track_searches" .-> TARGET_SEARCHES
    RABBIT -- "7. Queue scraping tasks<br>by platform" --> SCRAPER_1001
    RABBIT --> SCRAPER_MIX & SCRAPER_SET
    SCRAPER_1001 -- "8a. Yield playlist items FIRST<br>item_type = 'playlist'" --> PLAYLISTS
    SCRAPER_1001 -- "8b. Yield track adjacencies<br>item_type = 'track_adjacency'" --> SONG_ADJACENCY
    SCRAPER_1001 -- "8c. Store individual tracks" --> SONGS
    SCRAPER_1001 -- "8d. Store artists" --> ARTISTS
    SCRAPER_MIX -- "9a. Yield playlist items FIRST" --> PLAYLISTS
    SCRAPER_MIX -- "9b. Yield track adjacencies" --> SONG_ADJACENCY
    SCRAPER_SET -- "10a. Yield playlist items FIRST" --> PLAYLISTS
    SCRAPER_SET -- "10b. Yield track adjacencies" --> SONG_ADJACENCY
    GRAPH_API -- "11. Fetch adjacency data<br>for visualization" --> SONG_ADJACENCY
    GRAPH_API --> SONGS & ARTISTS
    FE_Graph -- "12. Render interactive<br>D3.js force graph" --> GRAPH_API
    REST_API -- "13. Target tracks CRUD<br>/api/v1/target-tracks" --> TARGET_TRACKS
    REST_API --> REDIS
    WS_API --> REDIS
    PLAYLISTS -. ❌ Junction table<br>needs implementation .-> PLAYLIST_SONGS
    PLAYLIST_SONGS -. ❌ Links to songs .-> SONGS
    SONGS -. ❌ Artist relationships<br>needs implementation .-> SONG_ARTISTS
    SONG_ARTISTS -. ❌ Links to artists .-> ARTISTS
    SEARCHER -. 🆕 Future: Track which<br>target track found playlist .-> PLAYLIST_DISC
    FE_Stats -- "14. Performance metrics" --> REST_API
    FE_Stats --> GRAPH_API
    TARGET_TRACKS@{ shape: rect}
     FE_Main:::frontend
     FE_Target:::frontend
     FE_Graph:::frontend
     FE_DJ:::frontend
     FE_Stats:::frontend
     API_GW:::api
     REST_API:::api
     GRAPH_API:::api
     WS_API:::api
     ORCH:::orchestrator
     SEARCHER:::orchestrator
     RABBIT:::queue
     REDIS:::cache
     SCRAPER_1001:::scraper
     SCRAPER_MIX:::scraper
     SCRAPER_SET:::scraper
     OLLAMA:::scraper
     TARGET_TRACKS:::database
     TARGET_SEARCHES:::database
     PLAYLIST_DISC:::database
     SONGS:::database
     ARTISTS:::database
     SONG_ADJACENCY:::database
     PLAYLISTS:::database
     PLAYLIST_SONGS:::database
     VENUES:::database
     SONG_ARTISTS:::database
     ARTIST_COLLAB:::database
     SCRAPING_RUNS:::database
     NORM_TRACKS:::database
     STATUS:::frontend
    classDef frontend fill:#E8F4FD,stroke:#2196F3,stroke-width:2px
    classDef api fill:#FFF3E0,stroke:#FF9800,stroke-width:2px
    classDef orchestrator fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px
    classDef scraper fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
    classDef database fill:#FCE4EC,stroke:#E91E63,stroke-width:2px
    classDef cache fill:#FFEBEE,stroke:#F44336,stroke-width:2px
    classDef queue fill:#EDE7F6,stroke:#673AB7,stroke-width:2px
