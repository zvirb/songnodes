# YouTube Parser Configuration
# ============================
# YouTube hosts DJ sets, live performances, and music videos with tracklists
# in descriptions, comments, or chapters.

source_name: "YouTube"
source_type: "dj_archive"
base_url: "https://www.youtube.com"

selectors:
  tracklist_container:
    - "css:ytd-text-inline-expander#description-inline-expander"
    - "css:div#description"
    - "css:div.ytd-video-description-transcript-section-renderer"
    - "xpath://div[@id='description']"

  track_row:
    - "css:div.tracklist-entry"
    - "css:a.yt-simple-endpoint.chapter"
    - "xpath://a[contains(@class, 'chapter')]"

  track_title:
    - "css:span.track-name::text"
    - "css:span.chapter-title::text"
    - "xpath:.//span[contains(@class, 'track')]/text()"

  artist_name:
    - "css:span.artist::text"
    - "xpath:.//span[contains(@class, 'artist')]/text()"

  timestamp:
    - "css:span.ytd-chapter-renderer::text"
    - "css:a.yt-simple-endpoint::text"
    - "xpath:.//span[contains(@class, 'timestamp')]/text()"

  venue:
    - "css:span.event-venue::text"

  date:
    - "css:span#info-strings yt-formatted-string::text"
    - "css:div#info-text span::text"
    - "xpath://span[@id='info-strings']//text()"

  setlist_name:
    - "css:h1.ytd-watch-metadata yt-formatted-string::text"
    - "css:h1.title::text"
    - "xpath://h1[contains(@class, 'title')]//text()"

  notes:
    - "css:div#description-inline-expander span::text"
    - "css:div#description::text"
    - "xpath://div[@id='description']//text()"

regex_patterns:
  clean_track_title:
    - pattern: "^\\d+[\\-\\.\\)]\\s*"
      replace: ""
    - pattern: "\\[.*?\\]$"
      replace: ""
    - pattern: "\\s{2,}"
      replace: " "

  clean_artist_name:
    - pattern: "\\(.*?\\)"
      replace: ""
    - pattern: "^feat\\.?\\s+"
      replace: ""
      flags: "IGNORECASE"

  extract_timestamp:
    - pattern: "(\\d{1,2}:\\d{2}(?::\\d{2})?)"
      group: 1

  extract_date:
    - pattern: "(\\d{4}-\\d{2}-\\d{2})"
      group: 1
    - pattern: "(\\w+ \\d{1,2}, \\d{4})"
      group: 1

data_mapping:
  default_artist: ""
  default_genre: "DJ Set"
  source_identifier: "youtube"
  date_format: "%Y-%m-%d"
  extract_timestamps: true
  enable_nlp_fallback: true

pagination:
  enabled: false

validation:
  min_tracks: 1
  max_tracks: 300
  require_venue: false
  require_date: false

rate_limiting:
  download_delay: 3.0
  randomize_delay: 0.5
  concurrent_requests: 1

metadata:
  created_by: "SongNodes Team"
  created_at: "2025-11-21"
  last_updated: "2025-11-21"
  notes: "YouTube tracklists - may require Playwright for dynamic content, NLP fallback strongly recommended"
  source_url_pattern: "https://www.youtube.com/watch?v={video_id}"
  example_urls:
    - "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
    - "https://www.youtube.com/watch?v=5qap5aO4i9A"
  additional_notes: |
    YouTube pages are heavily JavaScript-dependent. The spider should use
    scrapy-playwright to render the page before extraction. Tracklists are
    often found in video descriptions or as chapter markers.
