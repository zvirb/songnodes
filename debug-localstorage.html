<!DOCTYPE html>
<html>
<head>
    <title>Debug localStorage</title>
</head>
<body>
    <h1>localStorage Debug</h1>
    <pre id="output"></pre>

    <script>
        const output = document.getElementById('output');
        let debug = '';

        // Check songnodes-store
        const store = localStorage.getItem('songnodes-store');
        debug += '=== songnodes-store RAW ===\n';
        debug += `Exists: ${!!store}\n`;
        debug += `Length: ${store?.length || 0} chars\n`;
        debug += `First 200 chars: ${store?.substring(0, 200) || 'N/A'}\n\n`;

        if (store) {
            try {
                const parsed = JSON.parse(store);

                debug += '=== PARSED STRUCTURE ===\n';
                debug += `Version: ${parsed.version}\n`;
                debug += `Has state: ${!!parsed.state}\n`;
                debug += `State type: ${typeof parsed.state}\n`;
                debug += `State keys: ${parsed.state ? Object.keys(parsed.state).join(', ') : 'N/A'}\n\n`;

                debug += '=== FULL PARSED DATA ===\n';
                debug += JSON.stringify(parsed, null, 2);

                debug += '\n\n=== musicCredentials SPECIFICALLY ===\n';
                debug += `Path: parsed.state.musicCredentials\n`;
                debug += `Exists: ${!!parsed.state?.musicCredentials}\n`;
                debug += `Type: ${typeof parsed.state?.musicCredentials}\n`;
                if (parsed.state?.musicCredentials) {
                    debug += `Keys: ${Object.keys(parsed.state.musicCredentials).join(', ')}\n`;
                    debug += `Content:\n${JSON.stringify(parsed.state.musicCredentials, null, 2)}`;
                } else {
                    debug += 'NOT FOUND in state';
                }

                debug += '\n\n=== ZUSTAND COMPATIBILITY CHECK ===\n';
                debug += `✓ Valid JSON: yes\n`;
                debug += `✓ Has version field: ${parsed.version ? 'yes (v' + parsed.version + ')' : 'NO ❌'}\n`;
                debug += `✓ Has state field: ${parsed.state ? 'yes' : 'NO ❌'}\n`;
                debug += `✓ state is object: ${typeof parsed.state === 'object' ? 'yes' : 'NO ❌'}\n`;

            } catch (e) {
                debug += '❌ Error parsing JSON: ' + e.message + '\n';
                debug += 'Stack: ' + e.stack;
            }
        } else {
            debug += '❌ NOT FOUND\n';
        }

        debug += '\n\n=== ALL localStorage keys ===\n';
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            debug += `${key}: ${localStorage.getItem(key).substring(0, 100)}...\n`;
        }

        output.textContent = debug;
    </script>
</body>
</html>